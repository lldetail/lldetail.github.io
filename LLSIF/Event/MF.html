<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
		<meta charset="UTF-8">
		<link rel="stylesheet" type="text/css" href="../cursor/style.css">
		<script src='song.js'></script>
		<style>
			* {
			  -webkit-box-sizing: border-box;
				 -moz-box-sizing: border-box;
					  box-sizing: border-box;
			}
			html {
				font-family: "Microsoft YaHei UI Light", "Microsoft YaHei UI", sans-serif;
			}
			table {
				border-spacing:0px;
			}
			th, td {
				border:1px solid black;
			}
			.Smile {
				background-color: #FF99CC;
			}
			.Pure {
				background-color: #CCFF99;
			}
			.Cool {
				background-color: #99CCFF;
			}
		</style>
	</head>
	<body style="margin: 0px; padding: 15px">
		<script>
			song = [];
			ele = ["Smile","Pure","Cool"];
			for (i = 0; i < song_list.length; i++){
				song[parseInt(song_list[i].sound.substring(27, 30))] = song_list[i];
			};
			function calc(){
				v = document.getElementById("event").value;
				res = '';
				if (v == '') {
					res = 'No data available!';
				} else {
					res = "<table style='width:100%'><tr><th style='width:10%'>Rank</th><th style='width:80%'>Combination</th><th style='width:10%'>Combo</th></tr>";
					selected = v.split(",");
					diff = document.getElementById("diff").value;
					element = [];
					element[0] = selected.slice(0, 8); //smile
					element[1] = selected.slice(8, 16); //pure
					element[2] = selected.slice(16, 24); //cool	
					sort_list = [];
					count = 0;
					for (n = 0; n <= 2; n++){
						for (i = 0; i < 6; i++){
							for (j = i+1; j < 7; j++){
								for (k = j+1; k < 8; k++){
									sort_list[count] = [];
									sort_list[count][0] = song[element[n][i]].name + " + " + song[element[n][j]].name + " + " + song[element[n][k]].name;
									sort_list[count][1] = song[element[n][i]].difficulties[diff].s_rank_combo + song[element[n][j]].difficulties[diff].s_rank_combo + song[element[n][k]].difficulties[diff].s_rank_combo;
									sort_list[count][2] = n;
									sort_list[count][4] = count;
									count ++;
								};
							};
						};
					};
					if (document.getElementById("num").value == 2){
						for (n = 0; n <= 2; n++){
							for (i = 0; i < 7; i++){
								for (j = i+1; j < 8; j++){
									sort_list[count] = [];
									sort_list[count][0] = song[element[n][i]].name + " + " + song[element[n][j]].name;
									sort_list[count][1] = song[element[n][i]].difficulties[diff].s_rank_combo + song[element[n][j]].difficulties[diff].s_rank_combo;
									sort_list[count][2] = n;
									sort_list[count][4] = count;
									count ++;
								};
							};
						};
						for (n = 0; n <= 2; n++){
							for (i = 0; i < 8; i++){
								sort_list[count] = [];
								sort_list[count][0] = song[element[n][i]].name;
								sort_list[count][1] = song[element[n][i]].difficulties[diff].s_rank_combo;
								sort_list[count][2] = n;
								sort_list[count][4] = count;
								count ++;
							};
						};
					};
					sort_list.sort(function(a, b) {
						return b[1]==a[1]?(a[2]==b[2]?a[4]-b[4]:a[2]-b[2]):b[1]-a[1];
					});
					for (m = 0; m < count; m++){
						sort_list[m][3] = (m == 0?1:sort_list[m][1] == sort_list[m-1][1]?sort_list[m-1][3]:m+1);
						res = res + "<tr class='" + ele[sort_list[m][2]] + "'><td>" + sort_list[m][3] + "</td><td>" + sort_list[m][0] + "</td><td>" + sort_list[m][1] + "</td></tr>";
					};
					res = res + '</table>';
				};
				document.getElementById("result").innerHTML=res;
			};
		</script>
		Event: <select id="event">
		  <option id="MF1" value=",,,,,,,,,,,,,,,,,,,,,,,">All 1 / TC 12</option>
		  <option id="MF2" value=",,,,,,,,,,,,,,,,,,,,,,,">All 2</option>
		  <option id="MF3" value=",,,,,,,,,,,,,,,,,,,,,,,">All 3</option>
		  <option id="MF4" value=",,,,,,,,,,,,,,,,,,,,,,,">All 4</option>
		  <option id="MF5" value=",,,,,,,,,,,,,,,,,,,,,,,">All 5</option>
		  <option id="MF6" value=",,,,,,,,,,,,,,,,,,,,,,,">All 6 / TC 11</option>
		  <option id="MF7" value=",,,,,,,,,,,,,,,,,,,,,,,">JP 7</option>
		  <option id="MF8" value=",,,,,,,,,,,,,,,,,,,,,,,">JP 8 / Other 7</option>
		  <option id="MF9" value=",,,,,,,,,,,,,,,,,,,,,,,">JP 9</option>
		  <option id="MF10" value=",,,,,,,,,,,,,,,,,,,,,,,">JP 10 / WW/TC 8 / CN 9</option>
		  <option id="MF11" value=",,,,,,,,,,,,,,,,,,,,,,,">JP 11 / WW 9 / CN 8</option>
		  <option id="MF12" value="5,33,39,27,38,65,72,73,7,26,34,36,53,62,69,93,6,9,28,30,32,41,43,61">JP 12 / WW/CN 10 / TC 9</option>
		  <option id="MF13" value="5,10,11,74,80,84,94,103,7,12,20,31,35,78,95,104,9,43,61,64,88,97,98,99">JP/WW 13 / TC 10 / CN 11</option>
		  <option id="MF14" value="5,25,52,66,73,76,86,100,2,36,53,55,62,102,110,111,3,37,40,42,71,77,101,126">JP/WW 14 / CN 12</option>
		  <option id="MF15" value="96,109,112,117,118,119,125,128,87,113,114,121,122,124,129,132,91,107,115,116,120,127,133,134">JP 15 / WW 11 / CN 13</option>
		  <option id="MF16" value="96,109,112,117,118,119,125,128,87,108,113,114,121,129,132,144,91,107,115,116,120,127,133,143">JP 16 / WW 12 / CN 14</option>
		  <option id="MF17" value="96,112,117,119,125,128,146,147,87,108,113,121,122,129,132,144,107,115,116,120,134,143,145,148">JP 17 / CN 15</option>
		  <option id="MF18" value="5,13,22,52,72,74,84,103,4,35,53,55,75,85,110,130,21,30,58,64,88,89,98,137">JP 18 / WW 15</option>
		</select><br>
		Diff: <select id="diff">
		  <option value="0">Easy</option>
		  <option value="1">Normal</option>
		  <option value="2">Hard</option>
		  <option value="3" selected>Expert</option>
		</select>
		&nbsp;&nbsp;Show: <select id="num">
		  <option value="1">3 Song Combinations</option>
		  <option value="2" selected>All Combinations</option>
		</select>
		<button onclick="calc()">Calculate</button>
		<div id="result">
		</div>
		<script>
			var url = new URL(window.location.href);
			var selected = url.searchParams.get("id");
			if (selected == null || document.getElementById('MF' + selected) == null){
				var theSelect = document.getElementById('event');
				theSelect.options[theSelect.options.length - 1].setAttribute("selected",true);
			} else {
				document.getElementById('MF' + selected).setAttribute("selected",true);
				calc();
			};
		</script>
	</body>
</html>